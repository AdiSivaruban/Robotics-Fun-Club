<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - Robotics Fun Club</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="gallery.css">
</head>
<body>
    <div class="animated-bg">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="gear">‚öôÔ∏è</div>
            <div class="gear">‚öôÔ∏è</div>
            <div class="gear">‚öôÔ∏è</div>
        </div>
        <div class="particles">
            <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
            <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
            <div class="particle" style="left: 30%; animation-delay: 4s;"></div>
            <div class="particle" style="left: 40%; animation-delay: 6s;"></div>
            <div class="particle" style="left: 50%; animation-delay: 8s;"></div>
            <div class="particle" style="left: 60%; animation-delay: 10s;"></div>
            <div class="particle" style="left: 70%; animation-delay: 12s;"></div>
            <div class="particle" style="left: 80%; animation-delay: 14s;"></div>
            <div class="particle" style="left: 90%; animation-delay: 16s;"></div>
        </div>
    </div>

    <nav>
    <div class="nav-container">
        <!-- FIXED: Clickable logo that works on ALL pages -->
        <a href="home.html" class="logo" aria-label="Robotics Fun Club - Go to homepage">
            <div class="robot-icon" aria-label="Robot logo"></div>
            <span>Robotics Fun Club</span>
        </a>
        <ul class="nav-links">
            <li><a href="home.html">Home</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="reviews.html">Reviews</a></li>
        </ul>
    </div>
</nav>

    <div class="container">
        <h1 class="section-title">üì∏ Project Gallery</h1>
        
        <!-- Upload Form -->
        <div class="upload-section">
            <div class="upload-form-container">
                <h3>üì∑ Share Your Project</h3>
                <form id="upload-form" onsubmit="handleUpload(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="uploader-name">Your Name *</label>
                            <input type="text" id="uploader-name" required placeholder="Enter your name">
                        </div>
                        <div class="form-group">
                            <label for="project-type">Project Type *</label>
                            <select id="project-type" required>
                                <option value="">Select a project...</option>
                                <option value="Rubber Band Boat">Rubber Band Boat</option>
                                <option value="Robot Arm Grabber">Robot Arm Grabber</option>
                                <option value="String Phone">String Phone</option>
                                <option value="Balloon Car">Balloon Car</option>
                                <option value="Popsicle Stick Catapult">Popsicle Stick Catapult</option>
                                <option value="Other">Other Project</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="photo-description">Description (Optional)</label>
                        <textarea id="photo-description" rows="3" placeholder="Tell us about your project..."></textarea>
                    </div>
                    <div class="upload-area" onclick="document.getElementById('photo-upload').click()">
                        <input type="file" id="photo-upload" accept="image/*" required onchange="previewPhoto(this)">
                        <div class="upload-icon">üì∑</div>
                        <h4>Click to Select Photo</h4>
                        <p class="upload-note">JPG, PNG, or GIF (Max 1MB)</p>
                        <div id="preview-container" style="display: none;">
                            <img id="photo-preview" alt="Preview">
                            <p class="preview-text">Click to change photo</p>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn" id="submit-btn">Upload Photo</button>
                    <div id="upload-status" style="display: none; text-align: center; margin-top: 1rem;">
                        <p style="color: #6c5ce7;">Uploading... Please wait</p>
                    </div>
                </form>
            </div>
        </div>

        <div class="empty-gallery" id="empty-gallery">
            <div class="empty-message">
                <div class="empty-icon">üé®</div>
                <h3>Your Gallery Awaits!</h3>
                <p>Upload photos of your completed projects to share with the community. Be the first to showcase your amazing creations!</p>
            </div>
        </div>

        <div class="photo-gallery" id="photo-gallery" style="display: none;">
            <!-- Photos will appear here -->
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="delete-modal" id="delete-modal" style="display: none;">
        <div class="modal-content">
            <h3>Delete Photo?</h3>
            <p>Are you sure you want to delete this photo? This action cannot be undone.</p>
            <div class="modal-actions">
                <button onclick="confirmDelete()" class="delete-confirm-btn">Yes, Delete</button>
                <button onclick="cancelDelete()" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Photo Viewer Modal for Mobile -->
    <div class="photo-viewer-modal" id="photo-viewer-modal" style="display: none;">
        <div class="viewer-header">
            <button onclick="closePhotoViewer()" class="close-viewer-btn">‚úï</button>
        </div>
        <div class="viewer-content">
            <img id="viewer-image" alt="Full size photo">
            <div class="viewer-details">
                <h3 id="viewer-title"></h3>
                <p id="viewer-author"></p>
                <p id="viewer-description"></p>
            </div>
            <div class="viewer-actions">
                <button onclick="downloadPhoto()" class="download-btn">
                    <span>üíæ</span> Save Photo
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (Database only - NO STORAGE) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <!-- Success Notification -->
    <div class="success-notification" id="success-notification">
        <div class="notification-content">
            <div class="notification-icon">‚úÖ</div>
            <div class="notification-text">
                <h4>Success!</h4>
                <p>Your photo has been uploaded to the gallery</p>
            </div>
        </div>
        <div class="notification-progress"></div>
    </div>

    <style>
        /* Success Notification Styles - FIXED VERSION */
        .success-notification {
            position: fixed;
            top: 100px;
            right: -400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 20px;
            z-index: 3000;
            transition: right 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow: hidden;
            min-width: 320px;
            /* Add these properties to ensure proper cleanup */
            opacity: 1;
            visibility: visible;
        }

        .success-notification.show {
            right: 20px;
        }

        /* Add hide class for proper cleanup */
        .success-notification.hide {
            right: -400px;
            opacity: 0;
            visibility: hidden;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            animation: checkmarkPop 0.6s ease;
        }

        @keyframes checkmarkPop {
            0% {
                transform: scale(0) rotate(-45deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0);
                opacity: 1;
            }
        }

        .notification-text h4 {
            margin: 0;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .notification-text p {
            margin: 0;
            color: #6b7280;
            font-size: 0.9rem;
        }

        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            /* Reduced animation time for better sync */
            animation: progressBar 2.5s linear forwards;
        }

        @keyframes progressBar {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }

        /* Celebration particles */
        .celebration-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2999;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            opacity: 0;
        }

        @keyframes particleFall {
            0% {
                transform: translateY(0) translateX(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(300px) translateX(var(--x-drift)) scale(0);
                opacity: 0;
            }
        }

        /* Mobile responsive - FIXED */
        @media (max-width: 768px) {
            .success-notification {
                top: auto;
                bottom: 20px;
                right: -100vw; /* Use viewport width for better mobile handling */
                left: auto;
                width: calc(100vw - 40px);
                min-width: auto;
                margin: 0 20px;
            }

            .success-notification.show {
                right: 0;
            }

            .success-notification.hide {
                right: -100vw;
                opacity: 0;
                visibility: hidden;
            }
        }
    </style>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHCyQH3p8095T1cFYZAf3fW0Lg7w0S4hA",
            authDomain: "robotics-fun-club.firebaseapp.com",
            databaseURL: "https://robotics-fun-club-default-rtdb.firebaseio.com",
            projectId: "robotics-fun-club",
            storageBucket: "robotics-fun-club.appspot.com",
            messagingSenderId: "141368327976",
            appId: "1:141368327976:web:ba47feecd87e87b56db93b"
        };

        // Initialize Firebase (Database only - NO STORAGE)
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let selectedFile = null;
        let photoToDelete = null;
        let currentViewerPhoto = null;

        // Get or create unique user ID
        function getUserId() {
            let userId = localStorage.getItem('roboticsUserId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('roboticsUserId', userId);
            }
            return userId;
        }

        // Load and display photos when page loads - UPDATED
        window.addEventListener('load', function() {
            // Clear any stuck notifications when page loads
            const notification = document.getElementById('success-notification');
            if (notification) {
                notification.classList.remove('show');
                notification.classList.add('hide');
            }
            loadPhotosFromFirebase();
        });

        // Load photos from Firebase
        function loadPhotosFromFirebase() {
            const photosRef = database.ref('photos');
            
            photosRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const photos = Object.entries(data).map(([id, photo]) => ({
                        id: id,
                        ...photo
                    })).reverse(); // Show newest first
                    displayPhotos(photos);
                } else {
                    displayPhotos([]);
                }
            });
        }

        // Compress image to base64
        function compressImage(file, maxWidth, maxHeight, quality) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        // Calculate new dimensions
                        if (width > height) {
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width *= maxHeight / height;
                                height = maxHeight;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // Convert to base64
                        const compressedBase64 = canvas.toDataURL('image/jpeg', quality);
                        resolve(compressedBase64);
                    };
                };
            });
        }

        // Preview selected photo
        function previewPhoto(input) {
            if (input.files && input.files[0]) {
                selectedFile = input.files[0];
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photo-preview').src = e.target.result;
                    document.getElementById('preview-container').style.display = 'block';
                    document.querySelector('.upload-area .upload-icon').style.display = 'none';
                    document.querySelector('.upload-area h4').style.display = 'none';
                    document.querySelector('.upload-area .upload-note').style.display = 'none';
                };
                reader.readAsDataURL(selectedFile);
            }
        }

        // Handle form submission
        async function handleUpload(event) {
            event.preventDefault();
            
            if (!selectedFile) {
                showErrorNotification('Please select a photo');
                return;
            }
            
            // Show loading status
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('upload-status').style.display = 'block';
            
            const name = document.getElementById('uploader-name').value;
            const project = document.getElementById('project-type').value;
            const description = document.getElementById('photo-description').value;
            const userId = getUserId();
            
            try {
                // Compress image to reduce size (smaller dimensions and quality for database storage)
                const compressedImage = await compressImage(selectedFile, 600, 450, 0.6);
                
                // Save photo data to Firebase Database
                const newPhotoRef = database.ref('photos').push();
                await newPhotoRef.set({
                    name: name,
                    project: project,
                    description: description || '',
                    imageData: compressedImage, // Store as base64
                    date: new Date().toISOString(),
                    timestamp: Date.now(),
                    userId: userId // Store user ID with photo
                });
                
                // Reset form
                document.getElementById('upload-form').reset();
                document.getElementById('preview-container').style.display = 'none';
                document.querySelector('.upload-area .upload-icon').style.display = 'block';
                document.querySelector('.upload-area h4').style.display = 'block';
                document.querySelector('.upload-area .upload-note').style.display = 'block';
                selectedFile = null;
                
                // Show success notification with celebration
                showSuccessNotification();
                createCelebrationParticles();
                
// Track photo uploads and show review prompt
const uploadCount = parseInt(localStorage.getItem('uploadedPhotosCount') || '0');
const newUploadCount = uploadCount + 1;
localStorage.setItem('uploadedPhotosCount', newUploadCount.toString());

// Show review prompt after 2nd photo upload (not too early, not too late)
if (newUploadCount === 2) {
    // Check if the review prompt system exists
    if (typeof reviewPromptSystem !== 'undefined') {
        reviewPromptSystem.showPromptForGallery();
    }
}
            } catch (error) {
                console.error('Upload error:', error);
                showErrorNotification('Error uploading photo. Please try again with a smaller image.');
            } finally {
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('upload-status').style.display = 'none';
            }
        }

        // Display all photos
        function displayPhotos(photos) {
            const gallery = document.getElementById('photo-gallery');
            const emptyGallery = document.getElementById('empty-gallery');
            const currentUserId = getUserId();
            
            if (photos.length === 0) {
                gallery.style.display = 'none';
                emptyGallery.style.display = 'flex';
                return;
            }
            
            gallery.style.display = 'grid';
            emptyGallery.style.display = 'none';
            
            gallery.innerHTML = photos.map(photo => {
                const canDelete = photo.userId === currentUserId || !photo.userId; // Allow deletion of old photos too
                return `
                    <div class="photo-item" data-id="${photo.id}" onclick="openPhotoViewer('${photo.id}')">
                        <img src="${photo.imageData}" alt="${photo.project}">
                        <div class="photo-caption">
                            <h4>${photo.project}</h4>
                            <p class="photo-author">By ${photo.name}</p>
                            ${photo.description ? `<p class="photo-desc">${photo.description}</p>` : ''}
                            <p class="photo-date">${new Date(photo.date).toLocaleDateString()}</p>
                        </div>
                        ${canDelete ? `
                            <button class="delete-btn" onclick="event.stopPropagation(); deletePhoto('${photo.id}')" title="Delete this photo">
                                <span>üóëÔ∏è</span>
                            </button>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Open photo viewer (especially useful for mobile)
        function openPhotoViewer(photoId) {
            const photosRef = database.ref(`photos/${photoId}`);
            photosRef.once('value', (snapshot) => {
                const photo = snapshot.val();
                if (photo) {
                    currentViewerPhoto = photo;
                    document.getElementById('viewer-image').src = photo.imageData;
                    document.getElementById('viewer-title').textContent = photo.project;
                    document.getElementById('viewer-author').textContent = `By ${photo.name}`;
                    document.getElementById('viewer-description').textContent = photo.description || '';
                    document.getElementById('photo-viewer-modal').style.display = 'flex';
                    document.body.style.overflow = 'hidden'; // Prevent scrolling
                }
            });
        }

        // Close photo viewer
        function closePhotoViewer() {
            document.getElementById('photo-viewer-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentViewerPhoto = null;
        }

        // Download photo
        function downloadPhoto() {
            if (!currentViewerPhoto) return;
            
            const link = document.createElement('a');
            link.href = currentViewerPhoto.imageData;
            link.download = `${currentViewerPhoto.project.replace(/\s+/g, '_')}_${currentViewerPhoto.name.replace(/\s+/g, '_')}.jpg`;
            link.click();
        }

        // Delete photo
        function deletePhoto(id) {
            photoToDelete = id;
            document.getElementById('delete-modal').style.display = 'flex';
        }

        // Confirm deletion
        async function confirmDelete() {
            if (photoToDelete) {
                try {
                    // Check if this is an old photo without userId
                    const photoRef = database.ref(`photos/${photoToDelete}`);
                    const snapshot = await photoRef.once('value');
                    const photo = snapshot.val();
                    
                    // If photo has no userId, ask for admin password
                    if (!photo.userId) {
                        const password = prompt('This is an old photo. Enter admin password to delete:');
                        if (password !== 'admin123') { // Change this password!
                            showErrorNotification('Incorrect password');
                            cancelDelete();
                            return;
                        }
                    }
                    
                    await database.ref(`photos/${photoToDelete}`).remove();
                    cancelDelete();
                    showDeleteNotification();
                } catch (error) {
                    console.error('Delete error:', error);
                    showErrorNotification('Error deleting photo. Please try again.');
                }
            }
        }

        // Cancel deletion
        function cancelDelete() {
            photoToDelete = null;
            document.getElementById('delete-modal').style.display = 'none';
        }

        // Show success notification - FIXED VERSION
        function showSuccessNotification() {
            const notification = document.getElementById('success-notification');
            const icon = notification.querySelector('.notification-icon');
            const title = notification.querySelector('.notification-text h4');
            const message = notification.querySelector('.notification-text p');
            
            // Clear any existing timeouts
            if (window.notificationTimeout) {
                clearTimeout(window.notificationTimeout);
            }
            
            // Reset notification state
            notification.classList.remove('hide');
            notification.style.opacity = '1';
            notification.style.visibility = 'visible';
            
            // Set to success style
            icon.textContent = '‚úÖ';
            icon.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
            title.textContent = 'Success!';
            message.textContent = 'Your photo has been uploaded to the gallery';
            
            // Show notification
            notification.classList.add('show');
            
            // Auto-hide after 2.5 seconds (sync with progress bar)
            window.notificationTimeout = setTimeout(() => {
                hideNotification();
            }, 2500);
        }

        // Create celebration particles
        function createCelebrationParticles() {
            const container = document.createElement('div');
            container.className = 'celebration-particles';
            document.body.appendChild(container);
            
            const colors = ['#10b981', '#3b82f6', '#8b5cf6', '#ef4444', '#f59e0b', '#ec4899'];
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * 200 + 'px';
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.setProperty('--x-drift', (Math.random() - 0.5) * 100 + 'px');
                    particle.style.animation = `particleFall ${1 + Math.random() * 2}s ease-out forwards`;
                    container.appendChild(particle);
                }, i * 30);
            }
            
            // Clean up particles after animation
            setTimeout(() => {
                container.remove();
            }, 4000);
        }

        // Show delete notification - FIXED VERSION
        function showDeleteNotification() {
            const notification = document.getElementById('success-notification');
            const icon = notification.querySelector('.notification-icon');
            const title = notification.querySelector('.notification-text h4');
            const message = notification.querySelector('.notification-text p');
            
            // Clear any existing timeouts
            if (window.notificationTimeout) {
                clearTimeout(window.notificationTimeout);
            }
            
            // Reset notification state
            notification.classList.remove('hide');
            notification.style.opacity = '1';
            notification.style.visibility = 'visible';
            
            // Change to delete style
            icon.textContent = 'üóëÔ∏è';
            icon.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            title.textContent = 'Deleted!';
            message.textContent = 'Photo has been removed from the gallery';
            
            // Show notification
            notification.classList.add('show');
            
            // Hide after 2.5 seconds
            window.notificationTimeout = setTimeout(() => {
                hideNotification();
            }, 2500);
        }

        // Show error notification - FIXED VERSION
        function showErrorNotification(errorMessage) {
            const notification = document.getElementById('success-notification');
            const icon = notification.querySelector('.notification-icon');
            const title = notification.querySelector('.notification-text h4');
            const messageEl = notification.querySelector('.notification-text p');
            
            // Clear any existing timeouts
            if (window.notificationTimeout) {
                clearTimeout(window.notificationTimeout);
            }
            
            // Reset notification state
            notification.classList.remove('hide');
            notification.style.opacity = '1';
            notification.style.visibility = 'visible';
            
            // Change to error style
            icon.textContent = '‚ùå';
            icon.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            title.textContent = 'Error!';
            messageEl.textContent = errorMessage;
            
            // Show notification
            notification.classList.add('show');
            
            // Hide after 2.5 seconds
            window.notificationTimeout = setTimeout(() => {
                hideNotification();
            }, 2500);
        }

        // Proper hide function - NEW
        function hideNotification() {
            const notification = document.getElementById('success-notification');
            
            // Add hide class and remove show class
            notification.classList.remove('show');
            notification.classList.add('hide');
            
            // Extra cleanup after animation completes
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.visibility = 'hidden';
            }, 500); // Wait for slide-out animation
        }

        // Close modals when clicking outside
        document.getElementById('delete-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelDelete();
            }
        });

        document.getElementById('photo-viewer-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePhotoViewer();
            }
        });
    </script>
    <div class="review-prompt-modal" id="reviewPromptModal" style="display: none;">
    <div class="review-prompt-content">
        <button class="prompt-close" onclick="closeReviewPrompt()">‚úï</button>
        
        <div class="prompt-icon" id="promptIcon">üåü</div>
        
        <h3 id="promptTitle">Great job!</h3>
        <p id="promptMessage">Would you like to share your experience?</p>
        
        <div class="prompt-actions">
            <button class="prompt-btn-primary" onclick="goToReview()">
                <span>‚úçÔ∏è</span> Write a Review
            </button>
            <button class="prompt-btn-secondary" onclick="maybeLaterReview()">
                Maybe Later
            </button>
        </div>
        
        <div class="prompt-footer">
            <label class="dont-ask-again">
                <input type="checkbox" id="dontAskAgain" onchange="updateAskPreference()">
                <span>Don't ask me again today</span>
            </label>
        </div>
    </div>
</div>

<!-- Add these styles -->
<style>
/* Review Prompt Modal Styles */
.review-prompt-modal {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1500;
    animation: slideInUp 0.5s ease-out;
    max-width: 380px;
}

@keyframes slideInUp {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.review-prompt-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    position: relative;
    border: 3px solid #f0f0f0;
}

.prompt-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #999;
    cursor: pointer;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.prompt-close:hover {
    background: #f0f0f0;
    color: #333;
}

.prompt-icon {
    font-size: 4rem;
    text-align: center;
    margin-bottom: 15px;
    animation: bounce 1s ease-in-out;
}

@keyframes bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.review-prompt-content h3 {
    color: #333;
    font-size: 1.5rem;
    margin-bottom: 10px;
    text-align: center;
}

.review-prompt-content p {
    color: #666;
    text-align: center;
    margin-bottom: 20px;
    line-height: 1.5;
}

.prompt-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
}

.prompt-btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.prompt-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

.prompt-btn-secondary {
    background: transparent;
    color: #999;
    border: 2px solid #e0e0e0;
    padding: 10px 20px;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.prompt-btn-secondary:hover {
    background: #f8f8f8;
    border-color: #ccc;
}

.prompt-footer {
    text-align: center;
    padding-top: 10px;
    border-top: 1px solid #f0f0f0;
}

.dont-ask-again {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    color: #999;
}

.dont-ask-again input {
    cursor: pointer;
}

/* Mobile responsive */
@media (max-width: 768px) {
    .review-prompt-modal {
        bottom: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
    }
    
    .review-prompt-content {
        padding: 25px;
    }
}

/* Subtle entrance for non-intrusive feel */
.review-prompt-modal.gentle-show {
    animation: gentleSlideIn 0.8s ease-out;
}

@keyframes gentleSlideIn {
    0% {
        transform: translateY(100%) scale(0.95);
        opacity: 0;
    }
    70% {
        transform: translateY(-5%) scale(1.02);
    }
    100% {
        transform: translateY(0) scale(1);
        opacity: 1;
    }
}
</style>

<!-- Add this JavaScript -->
<script>
// Smart Review Prompt System
class SmartReviewPrompt {
    constructor() {
        this.STORAGE_KEYS = {
            lastPrompt: 'lastReviewPrompt',
            dontAskToday: 'dontAskReviewToday',
            promptCount: 'reviewPromptCount',
            hasReviewed: 'hasLeftReview',
            completedProjects: 'completedProjects',
            uploadedPhotos: 'uploadedPhotosCount'
        };
        
        this.init();
    }
    
    init() {
        // Check if user has already reviewed
        this.hasReviewed = localStorage.getItem(this.STORAGE_KEYS.hasReviewed) === 'true';
        
        // Check if we should skip prompts today
        const dontAskToday = localStorage.getItem(this.STORAGE_KEYS.dontAskToday);
        if (dontAskToday) {
            const savedDate = new Date(dontAskToday);
            const today = new Date();
            if (savedDate.toDateString() !== today.toDateString()) {
                // It's a new day, reset the preference
                localStorage.removeItem(this.STORAGE_KEYS.dontAskToday);
            }
        }
    }
    
    shouldShowPrompt() {
        // Don't show if user has already reviewed
        if (this.hasReviewed) return false;
        
        // Don't show if user said "don't ask today"
        const dontAskToday = localStorage.getItem(this.STORAGE_KEYS.dontAskToday);
        if (dontAskToday) {
            const savedDate = new Date(dontAskToday);
            const today = new Date();
            if (savedDate.toDateString() === today.toDateString()) {
                return false;
            }
        }
        
        // Check how many times we've prompted
        const promptCount = parseInt(localStorage.getItem(this.STORAGE_KEYS.promptCount) || '0');
        if (promptCount >= 3) {
            // Maximum 3 prompts per week
            const lastPrompt = localStorage.getItem(this.STORAGE_KEYS.lastPrompt);
            if (lastPrompt) {
                const daysSincePrompt = (Date.now() - new Date(lastPrompt).getTime()) / (1000 * 60 * 60 * 24);
                if (daysSincePrompt < 7) {
                    return false; // Wait a week before prompting again
                } else {
                    // Reset count after a week
                    localStorage.setItem(this.STORAGE_KEYS.promptCount, '0');
                }
            }
        }
        
        // Check if enough time has passed since last prompt (at least 2 days)
        const lastPrompt = localStorage.getItem(this.STORAGE_KEYS.lastPrompt);
        if (lastPrompt) {
            const hoursSincePrompt = (Date.now() - new Date(lastPrompt).getTime()) / (1000 * 60 * 60);
            if (hoursSincePrompt < 48) {
                return false;
            }
        }
        
        return true;
    }
    
    showPromptForProject(projectName) {
        if (!this.shouldShowPrompt()) return;
        
        // Wait 3 seconds after project completion for better timing
        setTimeout(() => {
            const modal = document.getElementById('reviewPromptModal');
            const icon = document.getElementById('promptIcon');
            const title = document.getElementById('promptTitle');
            const message = document.getElementById('promptMessage');
            
            // Customize for project completion
            icon.textContent = 'üéâ';
            title.textContent = 'Amazing work!';
            message.textContent = `You completed the ${projectName}! Would you like to share how it went?`;
            
            modal.style.display = 'block';
            modal.classList.add('gentle-show');
            
            this.updatePromptTracking();
        }, 3000);
    }
    
    showPromptForGallery() {
        if (!this.shouldShowPrompt()) return;
        
        // Check if user has uploaded at least 2 photos before prompting
        const uploadCount = parseInt(localStorage.getItem(this.STORAGE_KEYS.uploadedPhotos) || '0');
        if (uploadCount < 2) return;
        
        // Wait 2 seconds after photo upload
        setTimeout(() => {
            const modal = document.getElementById('reviewPromptModal');
            const icon = document.getElementById('promptIcon');
            const title = document.getElementById('promptTitle');
            const message = document.getElementById('promptMessage');
            
            // Customize for gallery upload
            icon.textContent = 'üì∏';
            title.textContent = 'Beautiful creation!';
            message.textContent = 'Your project looks great! Would you like to tell others about your experience?';
            
            modal.style.display = 'block';
            modal.classList.add('gentle-show');
            
            this.updatePromptTracking();
        }, 2000);
    }
    
    updatePromptTracking() {
        // Update last prompt time
        localStorage.setItem(this.STORAGE_KEYS.lastPrompt, new Date().toISOString());
        
        // Increment prompt count
        const count = parseInt(localStorage.getItem(this.STORAGE_KEYS.promptCount) || '0');
        localStorage.setItem(this.STORAGE_KEYS.promptCount, (count + 1).toString());
    }
}

// Initialize the smart prompt system
const reviewPromptSystem = new SmartReviewPrompt();

// Functions for button actions
function closeReviewPrompt() {
    const modal = document.getElementById('reviewPromptModal');
    modal.style.display = 'none';
}

function goToReview() {
    // Mark that user is going to review
    localStorage.setItem('reviewPromptSource', 'prompt');
    
    // Get the completed project name if available
    const completedProjects = JSON.parse(localStorage.getItem('completedProjects') || '[]');
    if (completedProjects.length > 0) {
        // Pre-fill the last completed project
        localStorage.setItem('prefillProject', completedProjects[completedProjects.length - 1]);
    }
    
    // Redirect to reviews page
    window.location.href = 'reviews.html';
}

function maybeLaterReview() {
    closeReviewPrompt();
    // Track that user said maybe later (be less aggressive with future prompts)
    localStorage.setItem('reviewMaybeLater', new Date().toISOString());
}

function updateAskPreference() {
    const checkbox = document.getElementById('dontAskAgain');
    if (checkbox.checked) {
        // Don't ask again today
        localStorage.setItem('dontAskReviewToday', new Date().toISOString());
    }
}
</script>
</body>
</html>
