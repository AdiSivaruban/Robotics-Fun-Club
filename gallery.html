<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - Robotics Fun Club</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="gallery.css">
</head>
<body>
    <div class="animated-bg">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="gear">‚öôÔ∏è</div>
            <div class="gear">‚öôÔ∏è</div>
            <div class="gear">‚öôÔ∏è</div>
        </div>
        <div class="particles">
            <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
            <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
            <div class="particle" style="left: 30%; animation-delay: 4s;"></div>
            <div class="particle" style="left: 40%; animation-delay: 6s;"></div>
            <div class="particle" style="left: 50%; animation-delay: 8s;"></div>
            <div class="particle" style="left: 60%; animation-delay: 10s;"></div>
            <div class="particle" style="left: 70%; animation-delay: 12s;"></div>
            <div class="particle" style="left: 80%; animation-delay: 14s;"></div>
            <div class="particle" style="left: 90%; animation-delay: 16s;"></div>
        </div>
    </div>

    <nav>
        <div class="nav-container">
            <div class="logo">
                <div class="robot-icon"></div>
                Robotics Fun Club
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="reviews.html">Reviews</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1 class="section-title">üì∏ Project Gallery</h1>
        
        <!-- Upload Form -->
        <div class="upload-section">
            <div class="upload-form-container">
                <h3>üì∑ Share Your Project</h3>
                <form id="upload-form" onsubmit="handleUpload(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="uploader-name">Your Name *</label>
                            <input type="text" id="uploader-name" required placeholder="Enter your name">
                        </div>
                        <div class="form-group">
                            <label for="project-type">Project Type *</label>
                            <select id="project-type" required>
                                <option value="">Select a project...</option>
                                <option value="Rubber Band Boat">Rubber Band Boat</option>
                                <option value="Robot Arm Grabber">Robot Arm Grabber</option>
                                <option value="String Phone">String Phone</option>
                                <option value="Balloon Car">Balloon Car</option>
                                <option value="Other">Other Project</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="photo-description">Description (Optional)</label>
                        <textarea id="photo-description" rows="3" placeholder="Tell us about your project..."></textarea>
                    </div>
                    <div class="upload-area" onclick="document.getElementById('photo-upload').click()">
                        <input type="file" id="photo-upload" accept="image/*" required onchange="previewPhoto(this)">
                        <div class="upload-icon">üì∑</div>
                        <h4>Click to Select Photo</h4>
                        <p class="upload-note">JPG, PNG, or GIF (Max 5MB)</p>
                        <div id="preview-container" style="display: none;">
                            <img id="photo-preview" alt="Preview">
                            <p class="preview-text">Click to change photo</p>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn" id="submit-btn">Upload Photo</button>
                    <div id="upload-status" style="display: none; text-align: center; margin-top: 1rem;">
                        <p style="color: #6c5ce7;">Uploading... Please wait</p>
                    </div>
                </form>
            </div>
        </div>

        <div class="empty-gallery" id="empty-gallery">
            <div class="empty-message">
                <div class="empty-icon">üé®</div>
                <h3>Your Gallery Awaits!</h3>
                <p>Upload photos of your completed projects to share with the community. Be the first to showcase your amazing creations!</p>
            </div>
        </div>

        <div class="photo-gallery" id="photo-gallery" style="display: none;">
            <!-- Photos will appear here -->
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="delete-modal" id="delete-modal" style="display: none;">
        <div class="modal-content">
            <h3>Delete Photo?</h3>
            <p>Are you sure you want to delete this photo? This action cannot be undone.</p>
            <div class="modal-actions">
                <button onclick="confirmDelete()" class="delete-confirm-btn">Yes, Delete</button>
                <button onclick="cancelDelete()" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

    <script>
        // Firebase Configuration
        // IMPORTANT: Replace these with your own Firebase project credentials
        // Get them from: https://console.firebase.google.com/project/YOUR_PROJECT/settings/general/
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        let selectedFile = null;
        let photoToDelete = null;

        // Load and display photos when page loads
        window.addEventListener('load', function() {
            loadPhotosFromFirebase();
        });

        // Load photos from Firebase
        function loadPhotosFromFirebase() {
            const photosRef = database.ref('photos');
            
            photosRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const photos = Object.entries(data).map(([id, photo]) => ({
                        id: id,
                        ...photo
                    })).reverse(); // Show newest first
                    displayPhotos(photos);
                } else {
                    displayPhotos([]);
                }
            });
        }

        // Preview selected photo
        function previewPhoto(input) {
            if (input.files && input.files[0]) {
                selectedFile = input.files[0];
                
                if (selectedFile.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    input.value = '';
                    selectedFile = null;
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photo-preview').src = e.target.result;
                    document.getElementById('preview-container').style.display = 'block';
                    document.querySelector('.upload-area .upload-icon').style.display = 'none';
                    document.querySelector('.upload-area h4').style.display = 'none';
                    document.querySelector('.upload-area .upload-note').style.display = 'none';
                };
                reader.readAsDataURL(selectedFile);
            }
        }

        // Handle form submission
        async function handleUpload(event) {
            event.preventDefault();
            
            if (!selectedFile) {
                alert('Please select a photo');
                return;
            }
            
            // Show loading status
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('upload-status').style.display = 'block';
            
            const name = document.getElementById('uploader-name').value;
            const project = document.getElementById('project-type').value;
            const description = document.getElementById('photo-description').value;
            
            try {
                // Upload image to Firebase Storage
                const timestamp = Date.now();
                const fileName = `photos/${timestamp}_${selectedFile.name}`;
                const storageRef = storage.ref(fileName);
                const uploadTask = await storageRef.put(selectedFile);
                const downloadURL = await uploadTask.ref.getDownloadURL();
                
                // Save photo data to Firebase Database
                const newPhotoRef = database.ref('photos').push();
                await newPhotoRef.set({
                    name: name,
                    project: project,
                    description: description || '',
                    imageUrl: downloadURL,
                    date: new Date().toISOString(),
                    timestamp: timestamp
                });
                
                // Reset form
                document.getElementById('upload-form').reset();
                document.getElementById('preview-container').style.display = 'none';
                document.querySelector('.upload-area .upload-icon').style.display = 'block';
                document.querySelector('.upload-area h4').style.display = 'block';
                document.querySelector('.upload-area .upload-note').style.display = 'block';
                selectedFile = null;
                
                alert('Photo uploaded successfully!');
            } catch (error) {
                console.error('Upload error:', error);
                alert('Error uploading photo. Please try again.');
            } finally {
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('upload-status').style.display = 'none';
            }
        }

        // Display all photos
        function displayPhotos(photos) {
            const gallery = document.getElementById('photo-gallery');
            const emptyGallery = document.getElementById('empty-gallery');
            
            if (photos.length === 0) {
                gallery.style.display = 'none';
                emptyGallery.style.display = 'flex';
                return;
            }
            
            gallery.style.display = 'grid';
            emptyGallery.style.display = 'none';
            
            gallery.innerHTML = photos.map(photo => `
                <div class="photo-item" data-id="${photo.id}">
                    <img src="${photo.imageUrl}" alt="${photo.project}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22250%22%3E%3Crect width=%22300%22 height=%22250%22 fill=%22%23ddd%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22%23999%22%3EImage Loading...%3C/text%3E%3C/svg%3E'">
                    <div class="photo-caption">
                        <h4>${photo.project}</h4>
                        <p class="photo-author">By ${photo.name}</p>
                        ${photo.description ? `<p class="photo-desc">${photo.description}</p>` : ''}
                        <p class="photo-date">${new Date(photo.date).toLocaleDateString()}</p>
                    </div>
                    <button class="delete-btn" onclick="deletePhoto('${photo.id}')" title="Delete this photo">
                        <span>üóëÔ∏è</span>
                    </button>
                </div>
            `).join('');
        }

        // Delete photo
        function deletePhoto(id) {
            photoToDelete = id;
            document.getElementById('delete-modal').style.display = 'flex';
        }

        // Confirm deletion
        async function confirmDelete() {
            if (photoToDelete) {
                try {
                    // Delete from Firebase Database
                    await database.ref(`photos/${photoToDelete}`).remove();
                    
                    // Note: In a production app, you'd also delete the image from Storage
                    // This requires knowing the storage path, which you'd save with the photo data
                    
                    cancelDelete();
                } catch (error) {
                    console.error('Delete error:', error);
                    alert('Error deleting photo. Please try again.');
                }
            }
        }

        // Cancel deletion
        function cancelDelete() {
            photoToDelete = null;
            document.getElementById('delete-modal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.getElementById('delete-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelDelete();
            }
        });
    </script>
    <script src="navigation.js"></script>
</body>
</html>
