<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reviews - Robotics Fun Club</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="reviews.css">
</head>
<body>
    <div class="animated-bg">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="gear">‚öôÔ∏è</div>
            <div class="gear">‚öôÔ∏è</div>
            <div class="gear">‚öôÔ∏è</div>
        </div>
        <div class="particles">
            <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
            <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
            <div class="particle" style="left: 30%; animation-delay: 4s;"></div>
            <div class="particle" style="left: 40%; animation-delay: 6s;"></div>
            <div class="particle" style="left: 50%; animation-delay: 8s;"></div>
            <div class="particle" style="left: 60%; animation-delay: 10s;"></div>
            <div class="particle" style="left: 70%; animation-delay: 12s;"></div>
            <div class="particle" style="left: 80%; animation-delay: 14s;"></div>
            <div class="particle" style="left: 90%; animation-delay: 16s;"></div>
        </div>
    </div>

    <nav>
        <div class="nav-container">
            <div class="logo">
                <div class="robot-icon"></div>
                Robotics Fun Club
            </div>
            <ul class="nav-links">
                <li><a href="home.html">Home</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="events.html">Events</a></li>
                <li><a href="reviews.html">Reviews</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1 class="section-title">‚≠ê Reviews & Feedback</h1>
        
        <div class="feedback-form">
            <h3>Share Your Experience!</h3>
            <form id="review-form" onsubmit="submitReview(event)">
                <div class="form-group">
                    <label for="reviewer-name">Your Name:</label>
                    <input type="text" id="reviewer-name" required>
                </div>
                <div class="form-group">
                    <label for="project-completed">Which project did you complete?</label>
                    <select id="project-completed" required>
                        <option value="">Select a project...</option>
                        <option value="Rubber Band Boat">Rubber Band Boat</option>
                        <option value="Robot Arm Grabber">Robot Arm Grabber</option>
                        <option value="String Phone">String Phone</option>
                        <option value="Balloon Car">Balloon Car</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rating">Rating:</label>
                    <select id="rating" required>
                        <option value="">Rate your experience...</option>
                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Amazing!</option>
                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Great!</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê Good</option>
                        <option value="2">‚≠ê‚≠ê Okay</option>
                        <option value="1">‚≠ê Needs improvement</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="review-text">Your Review:</label>
                    <textarea id="review-text" rows="4" placeholder="Tell us about your experience building this project!" required></textarea>
                </div>
                <button type="submit" class="cta-button" id="submit-btn">Submit Review</button>
                <div id="submit-status" style="display: none; text-align: center; margin-top: 1rem;">
                    <p style="color: #6c5ce7;">Submitting review...</p>
                </div>
            </form>
        </div>

        <div class="empty-reviews" id="empty-reviews">
            <div class="empty-message">
                <h3>üåü Be the First to Review!</h3>
                <p>Share your experience with our projects and help others discover the joy of DIY robotics. Your feedback helps us improve and inspires other young builders!</p>
            </div>
        </div>

        <div class="reviews-container" id="reviews-container" style="display: none;">
            <!-- Reviews will appear here -->
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="delete-modal" id="delete-modal" style="display: none;">
        <div class="modal-content">
            <h3>Delete Review?</h3>
            <p>Are you sure you want to delete this review? This action cannot be undone.</p>
            <div class="modal-actions">
                <button onclick="confirmDeleteReview()" class="delete-confirm-btn">Yes, Delete</button>
                <button onclick="cancelDeleteReview()" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Success Notification -->
    <div class="success-notification" id="success-notification">
        <div class="notification-content">
            <div class="notification-icon">‚úÖ</div>
            <div class="notification-text">
                <h4>Success!</h4>
                <p>Your review has been submitted</p>
            </div>
        </div>
        <div class="notification-progress"></div>
    </div>

    <style>
  /* Success Notification Styles - FIXED VERSION */
.success-notification {
    position: fixed;
    top: 100px;
    right: -400px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    padding: 20px;
    z-index: 3000;
    transition: right 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    overflow: hidden;
    min-width: 320px;
    /* Add these properties to ensure proper cleanup */
    opacity: 1;
    visibility: visible;
}

.success-notification.show {
    right: 20px;
}

/* Add hide class for proper cleanup */
.success-notification.hide {
    right: -400px;
    opacity: 0;
    visibility: hidden;
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.notification-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    animation: checkmarkPop 0.6s ease;
}

@keyframes checkmarkPop {
    0% {
        transform: scale(0) rotate(-45deg);
        opacity: 0;
    }
    50% {
        transform: scale(1.2) rotate(10deg);
    }
    100% {
        transform: scale(1) rotate(0);
        opacity: 1;
    }
}

.notification-text h4 {
    margin: 0;
    color: #1f2937;
    font-size: 1.1rem;
}

.notification-text p {
    margin: 0;
    color: #6b7280;
    font-size: 0.9rem;
}

.notification-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 4px;
    background: linear-gradient(90deg, #10b981 0%, #059669 100%);
    /* Reduced animation time for better sync */
    animation: progressBar 2.5s linear forwards;
}

@keyframes progressBar {
    from {
        width: 100%;
    }
    to {
        width: 0%;
    }
}

/* Mobile responsive - FIXED */
@media (max-width: 768px) {
    .success-notification {
        top: auto;
        bottom: 20px;
        right: -100vw; /* Use viewport width for better mobile handling */
        left: auto;
        width: calc(100vw - 40px);
        min-width: auto;
        margin: 0 20px;
    }

    .success-notification.show {
        right: 0;
    }

    .success-notification.hide {
        right: -100vw;
        opacity: 0;
        visibility: hidden;
    }
}
    </style>

    <!-- Firebase SDK (Database only) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration - Same as gallery
        const firebaseConfig = {
            apiKey: "AIzaSyDHCyQH3p8095T1cFYZAf3fW0Lg7w0S4hA",
            authDomain: "robotics-fun-club.firebaseapp.com",
            databaseURL: "https://robotics-fun-club-default-rtdb.firebaseio.com",
            projectId: "robotics-fun-club",
            storageBucket: "robotics-fun-club.appspot.com",
            messagingSenderId: "141368327976",
            appId: "1:141368327976:web:ba47feecd87e87b56db93b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let reviewToDelete = null;

        // Get or create unique user ID (same as gallery)
        function getUserId() {
            let userId = localStorage.getItem('roboticsUserId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('roboticsUserId', userId);
            }
            return userId;
        }

        // Load reviews when page loads
        window.addEventListener('load', function() {
            loadReviewsFromFirebase();
        });

        // Load reviews from Firebase
        function loadReviewsFromFirebase() {
            const reviewsRef = database.ref('reviews');
            
            reviewsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const reviews = Object.entries(data).map(([id, review]) => ({
                        id: id,
                        ...review
                    })).reverse(); // Show newest first
                    displayReviews(reviews);
                } else {
                    displayReviews([]);
                }
            });
        }

        // Submit review
        async function submitReview(event) {
            event.preventDefault();
            
            // Show loading
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('submit-status').style.display = 'block';
            
            const name = document.getElementById('reviewer-name').value;
            const project = document.getElementById('project-completed').value;
            const rating = document.getElementById('rating').value;
            const reviewText = document.getElementById('review-text').value;
            const userId = getUserId();
            
            try {
                // Save review to Firebase
                const newReviewRef = database.ref('reviews').push();
                await newReviewRef.set({
                    name: name,
                    project: project,
                    rating: parseInt(rating),
                    reviewText: reviewText,
                    date: new Date().toISOString(),
                    timestamp: Date.now(),
                    userId: userId
                });
                
                // Reset form
                document.getElementById('review-form').reset();
                
                // Show success notification with star burst
                showSuccessNotification();
                createStarBurst();
                
            } catch (error) {
                console.error('Submit error:', error);
                showErrorNotification('Error submitting review. Please try again.');
            } finally {
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('submit-status').style.display = 'none';
            }
        }

        // Display reviews
        function displayReviews(reviews) {
            const container = document.getElementById('reviews-container');
            const emptyMessage = document.getElementById('empty-reviews');
            const currentUserId = getUserId();
            
            if (reviews.length === 0) {
                container.style.display = 'none';
                emptyMessage.style.display = 'flex';
                return;
            }
            
            container.style.display = 'grid';
            emptyMessage.style.display = 'none';
            
            container.innerHTML = reviews.map(review => {
                const stars = '‚≠ê'.repeat(review.rating);
                const canDelete = review.userId === currentUserId;
                
                return `
                    <div class="review-card" data-id="${review.id}">
                        <div class="review-header">
                            <div class="reviewer-avatar">${review.name.charAt(0).toUpperCase()}</div>
                            <div class="reviewer-info">
                                <strong>${review.name}</strong>
                                <div class="stars">${stars}</div>
                                <div class="project-tag">${review.project}</div>
                            </div>
                            ${canDelete ? `
                                <button class="delete-review-btn" onclick="deleteReview('${review.id}')" title="Delete this review">
                                    üóëÔ∏è
                                </button>
                            ` : ''}
                        </div>
                        <p>"${review.reviewText}"</p>
                        <div class="review-date">${new Date(review.date).toLocaleDateString()}</div>
                    </div>
                `;
            }).join('');
        }

        // Delete review
        function deleteReview(id) {
            reviewToDelete = id;
            document.getElementById('delete-modal').style.display = 'flex';
        }

        // Confirm deletion
        async function confirmDeleteReview() {
            if (reviewToDelete) {
                try {
                    await database.ref(`reviews/${reviewToDelete}`).remove();
                    cancelDeleteReview();
                    showDeleteNotification();
                } catch (error) {
                    console.error('Delete error:', error);
                    showErrorNotification('Error deleting review. Please try again.');
                }
            }
        }

        // Cancel deletion
        function cancelDeleteReview() {
            reviewToDelete = null;
            document.getElementById('delete-modal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.getElementById('delete-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelDeleteReview();
            }
        });
        // Show success notification
        function showSuccessNotification() {
            const notification = document.getElementById('success-notification');
            const icon = notification.querySelector('.notification-icon');
            const title = notification.querySelector('.notification-text h4');
            const message = notification.querySelector('.notification-text p');
            
            // Set to success style
            icon.textContent = '‚≠ê';
            icon.style.background = 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)';
            title.textContent = 'Thank You!';
            message.textContent = 'Your review has been submitted';
            
            notification.classList.add('show');
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Create star burst effect
        function createStarBurst() {
            const mouseX = window.innerWidth / 2;
            const mouseY = window.innerHeight / 2;
            
            const burst = document.createElement('div');
            burst.className = 'star-burst';
            burst.style.left = mouseX + 'px';
            burst.style.top = mouseY + 'px';
            document.body.appendChild(burst);
            
            const stars = ['‚≠ê', '‚ú®', 'üåü', 'üí´', '‚≠ê'];
            const starCount = 8;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = stars[Math.floor(Math.random() * stars.length)];
                
                const angle = (i / starCount) * Math.PI * 2;
                const distance = 50 + Math.random() * 50;
                
                star.style.left = Math.cos(angle) * distance + 'px';
                star.style.top = Math.sin(angle) * distance + 'px';
                star.style.animationDelay = Math.random() * 0.3 + 's';
                
                burst.appendChild(star);
            }
            
            // Clean up after animation
            setTimeout(() => {
                burst.remove();
            }, 2500);
        }

        // Show delete notification
        function showDeleteNotification() {
            const notification = document.getElementById('success-notification');
            const icon = notification.querySelector('.notification-icon');
            const title = notification.querySelector('.notification-text h4');
            const message = notification.querySelector('.notification-text p');
            
            // Change to delete style
            icon.textContent = 'üóëÔ∏è';
            icon.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            title.textContent = 'Deleted!';
            message.textContent = 'Your review has been removed';
            
            notification.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Show error notification
        function showErrorNotification(errorMessage) {
            const notification = document.getElementById('success-notification');
            const icon = notification.querySelector('.notification-icon');
            const title = notification.querySelector('.notification-text h4');
            const messageEl = notification.querySelector('.notification-text p');
            
            // Change to error style
            icon.textContent = '‚ùå';
            icon.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            title.textContent = 'Error!';
            messageEl.textContent = errorMessage;
            
            notification.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
    <script src="navigation.js"></script>
</body>
</html>
